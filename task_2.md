# Задание 2
## Промпт на оптимизацию запроса
Для оптимизации запроса был отправлен следующий промпт:

---

Предложи правки запроса (select top 3000 * from dbo.F_WORKS_LIST()) без модификации структуры БД такие, что время выполнения запроса получения 3 000 заказов из 50 000 со средним количеством элементов в заказе равным 3 не будет превышать 1-2 сек.

---


## Ответ
Полученный ответ был проанализирован и сделаны следующие правки:

---

[modify_F_EMPLOYEE_FULLNAME.sql]

[modify_F_WORKS_LIST.sql]

---

## Основные изменения:
- F_WORKS_LIST теперь является inline table-valued function
- F_EMPLOYEE_FULLNAME теперь использует common table expression для вычисления готовых/неготовых анализов для заказа
- Был убран ORDER BY в F_EMPLOYEE_FULLNAME

## Тестирование улучшения

Замеры производительности после правок:

**1 запуск**:

Время синтаксического анализа и компиляции SQL Server: 
 время ЦП = 0 мс, истекшее время = 0 мс.

 Время работы SQL Server:
   Время ЦП = 0 мс, затраченное время = 0 мс.

(затронуто строк: 3000)

 Время работы SQL Server:
   Время ЦП = 47 мс, затраченное время = 149 мс.

Время выполнения: 2025-05-22T16:26:26.9493962+03:00

**2 запуск**:

Время синтаксического анализа и компиляции SQL Server: 
 время ЦП = 0 мс, истекшее время = 0 мс.

 Время работы SQL Server:
   Время ЦП = 0 мс, затраченное время = 0 мс.

(затронуто строк: 3000)

 Время работы SQL Server:
   Время ЦП = 47 мс, затраченное время = 129 мс.

Время выполнения: 2025-05-22T16:26:40.9960212+03:00

**3 запуск**:

Время синтаксического анализа и компиляции SQL Server: 
 время ЦП = 15 мс, истекшее время = 27 мс.

 Время работы SQL Server:
   Время ЦП = 0 мс, затраченное время = 0 мс.

(затронуто строк: 3000)

 Время работы SQL Server:
   Время ЦП = 31 мс, затраченное время = 146 мс.

Время выполнения: 2025-05-22T16:26:53.3387689+03:00
